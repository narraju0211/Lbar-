<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Controle de Patrocínio L-Bar</title>
    <style>
        /* Estilos CSS para o layout e aparência do painel de controle */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 20px;
            background-color: #f0f2f5;
            color: #333;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .container {
            background-color: #fff;
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 550px; /* Aumentado para acomodar mais campos */
            margin: 0 auto; /* Centraliza na tela */
            box-sizing: border-box;
        }

        h1 {
            color: #007bff;
            text-align: center;
            margin-bottom: 30px;
            font-size: 1.8em;
        }

        .section-title {
            font-size: 1.3em;
            color: #555;
            margin-bottom: 15px;
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
         }

        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #666;
        }

        input[type="text"],
        input[type="number"],
        textarea {
            width: calc(100% - 20px);
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1em;
            box-sizing: border-box;
        }

        textarea {
            resize: vertical;
            min-height: 80px;
        }

        input[type="file"] {
            width: 100%;
            padding: 10px 0;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1em;
            box-sizing: border-box;
            background-color: #f9f9f9;
        }

        input[type="range"] {
            width: 100%;
            margin-top: 10px;
        }

        .preview-logo, .preview-background {
            margin-top: 10px;
            text-align: center;
            border: 1px solid #eee;
            border-radius: 5px;
            padding: 5px;
            background-color: #fdfdfd;
            height: 100px; /* Altura fixa para pré-visualização */
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .preview-logo img, .preview-background img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
            display: none; /* Escondido por padrão */
        }
        .preview-logo img[src]:not([src=""]), .preview-background img[src]:not([src=""]) {
            display: block; /* Mostra se tiver src */
        }

        button {
            display: block;
            width: 100%;
            padding: 12px 20px;
            margin-top: 10px;
            border: none;
            border-radius: 5px;
            font-size: 1.1em;
            cursor: pointer;
            transition: background-color 0.3s ease;
            color: #fff;
        }

        button.toggle-button {
            background-color: #28a745; /* Verde para ligar */
        }
        button.toggle-button.active {
            background-color: #dc3545; /* Vermelho para desligar */
        }
        button.toggle-button:hover {
            opacity: 0.9;
        }

        button.set-sponsor-button {
            background-color: #007bff;
            margin-bottom: 15px;
        }
        button.set-sponsor-button:hover {
            background-color: #0056b3;
        }

        .current-visibility {
            text-align: center;
            font-size: 1.1em;
            margin-bottom: 20px;
            font-weight: bold;
        }
        .current-visibility span.on { color: #28a745; }
        .current-visibility span.off { color: #dc3545; }

        .note {
            font-size: 0.8em;
            color: #888;
            margin-top: 5px;
        }

        .sponsor-slots {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .slot {
            border: 1px solid #eee;
            padding: 15px;
            border-radius: 5px;
            background-color: #fdfdfd;
        }

        .slot-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        .slot-header h3 {
            margin: 0;
            color: #333;
            font-size: 1.1em;
        }
    </style>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
</head>
<body>
    <div class="container">
        <h1>Controle de Patrocínio L-Bar</h1>

        <div class="current-visibility">
            Estado da Overlay: <span id="visibilityStatus">Carregando...</span>
        </div>
        <button id="toggleVisibilityBtn" class="toggle-button">Carregando...</button>
    </div>

    <div class="container sponsor-slots">
        <div class="section-title">Configuração de Patrocinadores</div>

        <div class="slot">
            <div class="slot-header">
                <h3>Barra Lateral Esquerda</h3>
            </div>
            <div class="form-group">
                <label for="leftSponsorLogo">Logo do Patrocinador:</label>
                <input type="file" id="leftSponsorLogo" accept="image/*">
                <div class="preview-logo">
                    <img id="leftLogoPreview" src="" alt="Pré-visualização da Logo Esquerda">
                </div>
                <span class="note">Formato: PNG/JPG. Max: 1MB.</span>
            </div>
            <div class="form-group">
                <label for="leftSegmentInfo">Informações do Segmento:</label>
                <textarea id="leftSegmentInfo" placeholder="Ex: Construção Civil, Alimentos e Bebidas"></textarea>
            </div>
            <div class="form-group">
                <label for="leftContactInfo">Contato e Atendimento:</label>
                <textarea id="leftContactInfo" placeholder="Ex: (XX) XXXX-XXXX | Seg-Sex 9h-18h"></textarea>
            </div>
            <div class="form-group">
                <label for="leftBackgroundImage">Imagem de Fundo da Barra (Opcional):</label>
                <input type="file" id="leftBackgroundImage" accept="image/*">
                <div class="preview-background">
                    <img id="leftBackgroundPreview" src="" alt="Pré-visualização do Fundo Esquerdo">
                </div>
                <span class="note">Preenche o restante da barra. Formato: PNG/JPG. Max: 1MB.</span>
            </div>
            <div class="form-group">
                <label for="leftBackgroundOpacity">Transparência do Fundo:</label>
                <input type="range" id="leftBackgroundOpacity" min="0" max="1" step="0.05" value="1">
                <span id="leftOpacityValue" class="note">1.00</span>
            </div>
            <button class="set-sponsor-button" onclick="setSponsor('left')">Atualizar Patrocinador Esquerda</button>
        </div>

        <div class="slot">
            <div class="slot-header">
                <h3>Barra Inferior</h3>
            </div>
            <div class="form-group">
                <label for="bottomSponsorLogo">Logo do Patrocinador:</label>
                <input type="file" id="bottomSponsorLogo" accept="image/*">
                <div class="preview-logo">
                    <img id="bottomLogoPreview" src="" alt="Pré-visualização da Logo Inferior">
                </div>
                <span class="note">Formato: PNG/JPG. Max: 1MB.</span>
            </div>
            <div class="form-group">
                <label for="bottomSegmentInfo">Informações do Segmento:</label>
                <textarea id="bottomSegmentInfo" placeholder="Ex: Varejo, E-commerce"></textarea>
            </div>
            <div class="form-group">
                <label for="bottomContactInfo">Contato e Atendimento:</label>
                <textarea id="bottomContactInfo" placeholder="Ex: contato@empresa.com | (XX) YYYY-YYYY"></textarea>
            </div>
            <div class="form-group">
                <label for="bottomBackgroundImage">Imagem de Fundo da Barra (Opcional):</label>
                <input type="file" id="bottomBackgroundImage" accept="image/*">
                <div class="preview-background">
                    <img id="bottomBackgroundPreview" src="" alt="Pré-visualização do Fundo Inferior">
                </div>
                <span class="note">Preenche o restante da barra. Formato: PNG/JPG. Max: 1MB.</span>
            </div>
            <div class="form-group">
                <label for="bottomBackgroundOpacity">Transparência do Fundo:</label>
                <input type="range" id="bottomBackgroundOpacity" min="0" max="1" step="0.05" value="1">
                <span id="bottomOpacityValue" class="note">1.00</span>
            </div>
            <button class="set-sponsor-button" onclick="setSponsor('bottom')">Atualizar Patrocinador Inferior</button>
        </div>
    </div>

    <script>
        // ** SEU FIREBASE CONFIG ESTÁ AQUI (ATUALIZADO!) **
        const firebaseConfig = {
          apiKey: "AIzaSyAFp_iujrtqjiTU5yq2yNSBIpwgjQZZyns",
          authDomain: "aquilesplacarpro.firebaseapp.com",
          databaseURL: "https://aquilesplacarpro-default-rtdb.firebaseio.com",
          projectId: "aquilesplacarpro",
          storageBucket: "aquilesplacarpro.firebasestorage.app",
          messagingSenderId: "922321609151",
          appId: "1:922321609151:web:ba51f5b21b322cf0a4c10a"
        };

        // Inicializa o Firebase com suas configurações
        const app = firebase.initializeApp(firebaseConfig);
        const database = app.database(); // Referência ao Realtime Database
        // Refere-se ao nó 'sponsorOverlayState' no Realtime Database, onde os dados da overlay serão salvos
        const sponsorStateRef = database.ref('sponsorOverlayState');

        // Referências aos elementos HTML
        const toggleVisibilityBtn = document.getElementById('toggleVisibilityBtn');
        const visibilityStatus = document.getElementById('visibilityStatus');

        // Left Bar Elements
        const leftSponsorLogoInput = document.getElementById('leftSponsorLogo');
        const leftLogoPreview = document.getElementById('leftLogoPreview');
        const leftSegmentInfoTextarea = document.getElementById('leftSegmentInfo');
        const leftContactInfoTextarea = document.getElementById('leftContactInfo');
        const leftBackgroundImageInput = document.getElementById('leftBackgroundImage');
        const leftBackgroundPreview = document.getElementById('leftBackgroundPreview');
        const leftBackgroundOpacitySlider = document.getElementById('leftBackgroundOpacity');
        const leftOpacityValueSpan = document.getElementById('leftOpacityValue');

        // Bottom Bar Elements
        const bottomSponsorLogoInput = document.getElementById('bottomSponsorLogo');
        const bottomLogoPreview = document.getElementById('bottomLogoPreview');
        const bottomSegmentInfoTextarea = document.getElementById('bottomSegmentInfo');
        const bottomContactInfoTextarea = document.getElementById('bottomContactInfo');
        const bottomBackgroundImageInput = document.getElementById('bottomBackgroundImage');
        const bottomBackgroundPreview = document.getElementById('bottomBackgroundPreview');
        const bottomBackgroundOpacitySlider = document.getElementById('bottomBackgroundOpacity');
        const bottomOpacityValueSpan = document.getElementById('bottomOpacityValue');

        // Tamanho máximo de arquivo permitido (1MB = 1024 * 1024 bytes)
        const MAX_FILE_SIZE = 1 * 1024 * 1024; // 1MB

        // Helper para pré-visualizar e validar imagens
        function setupImageInput(inputElement, previewElement, opacitySlider = null, opacitySpan = null) {
            inputElement.addEventListener('change', (event) => {
                const file = event.target.files[0];
                if (file) {
                    if (file.size > MAX_FILE_SIZE) {
                        alert(`O arquivo selecionado (${(file.size / (1024 * 1024)).toFixed(2)} MB) é muito grande. O tamanho máximo permitido é ${MAX_FILE_SIZE / (1024 * 1024)} MB.`);
                        inputElement.value = ''; // Limpa o input file
                        previewElement.src = '';
                        previewElement.style.display = 'none';
                        return;
                    }
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        previewElement.src = e.target.result;
                        previewElement.style.display = 'block';
                    };
                    reader.readAsDataURL(file);
                } else {
                    previewElement.src = '';
                    previewElement.style.display = 'none';
                }
            });

            if (opacitySlider && opacitySpan) {
                opacitySlider.addEventListener('input', () => {
                    opacitySpan.textContent = parseFloat(opacitySlider.value).toFixed(2);
                });
            }
        }

        setupImageInput(leftSponsorLogoInput, leftLogoPreview);
        setupImageInput(leftBackgroundImageInput, leftBackgroundPreview, leftBackgroundOpacitySlider, leftOpacityValueSpan);
        setupImageInput(bottomSponsorLogoInput, bottomLogoPreview);
        setupImageInput(bottomBackgroundImageInput, bottomBackgroundPreview, bottomBackgroundOpacitySlider, bottomOpacityValueSpan);

        // Listener para mudanças nos dados da overlay no Firebase
        sponsorStateRef.on('value', (snapshot) => {
            const state = snapshot.val();
            if (state && typeof state.isVisible !== 'undefined') {
                updateToggleButton(state.isVisible);
                updateVisibilityStatus(state.isVisible);

                // Preenche os campos da Barra Esquerda
                if (state.leftSponsor) {
                    leftSponsorLogoInput.value = ''; // Clear file input for security (cannot set value)
                    leftLogoPreview.src = state.leftSponsor.logo || '';
                    leftLogoPreview.style.display = state.leftSponsor.logo ? 'block' : 'none';
                    leftSegmentInfoTextarea.value = state.leftSponsor.segmentInfo || '';
                    leftContactInfoTextarea.value = state.leftSponsor.contactInfo || '';
                    leftBackgroundImageInput.value = ''; // Clear file input
                    leftBackgroundPreview.src = state.leftSponsor.backgroundImage || '';
                    leftBackgroundPreview.style.display = state.leftSponsor.backgroundImage ? 'block' : 'none';
                    const opacityL = state.leftSponsor.backgroundOpacity !== undefined ? state.leftSponsor.backgroundOpacity : 1;
                    leftBackgroundOpacitySlider.value = opacityL;
                    leftOpacityValueSpan.textContent = parseFloat(opacityL).toFixed(2);
                } else {
                    // Reset all fields if no data
                    leftSponsorLogoInput.value = '';
                    leftLogoPreview.src = ''; leftLogoPreview.style.display = 'none';
                    leftSegmentInfoTextarea.value = '';
                    leftContactInfoTextarea.value = '';
                    leftBackgroundImageInput.value = '';
                    leftBackgroundPreview.src = ''; leftBackgroundPreview.style.display = 'none';
                    leftBackgroundOpacitySlider.value = 1;
                    leftOpacityValueSpan.textContent = '1.00';
                }

                // Preenche os campos da Barra Inferior
                if (state.bottomSponsor) {
                    bottomSponsorLogoInput.value = '';
                    bottomLogoPreview.src = state.bottomSponsor.logo || '';
                    bottomLogoPreview.style.display = state.bottomSponsor.logo ? 'block' : 'none';
                    bottomSegmentInfoTextarea.value = state.bottomSponsor.segmentInfo || '';
                    bottomContactInfoTextarea.value = state.bottomSponsor.contactInfo || '';
                    bottomBackgroundImageInput.value = '';
                    bottomBackgroundPreview.src = state.bottomSponsor.backgroundImage || '';
                    bottomBackgroundPreview.style.display = state.bottomSponsor.backgroundImage ? 'block' : 'none';
                    const opacityB = state.bottomSponsor.backgroundOpacity !== undefined ? state.bottomSponsor.backgroundOpacity : 1;
                    bottomBackgroundOpacitySlider.value = opacityB;
                    bottomOpacityValueSpan.textContent = parseFloat(opacityB).toFixed(2);
                } else {
                    // Reset all fields if no data
                    bottomSponsorLogoInput.value = '';
                    bottomLogoPreview.src = ''; bottomLogoPreview.style.display = 'none';
                    bottomSegmentInfoTextarea.value = '';
                    bottomContactInfoTextarea.value = '';
                    bottomBackgroundImageInput.value = '';
                    bottomBackgroundPreview.src = ''; bottomBackgroundPreview.style.display = 'none';
                    bottomBackgroundOpacitySlider.value = 1;
                    bottomOpacityValueSpan.textContent = '1.00';
                }

            } else {
                // Estado inicial se não houver dados no Firebase
                updateToggleButton(false);
                updateVisibilityStatus(false);
                // Reset all fields
                leftSponsorLogoInput.value = ''; leftLogoPreview.src = ''; leftLogoPreview.style.display = 'none';
                leftSegmentInfoTextarea.value = ''; leftContactInfoTextarea.value = '';
                leftBackgroundImageInput.value = ''; leftBackgroundPreview.src = ''; leftBackgroundPreview.style.display = 'none';
                leftBackgroundOpacitySlider.value = 1; leftOpacityValueSpan.textContent = '1.00';

                bottomSponsorLogoInput.value = ''; bottomLogoPreview.src = ''; bottomLogoPreview.style.display = 'none';
                bottomSegmentInfoTextarea.value = ''; bottomContactInfoTextarea.value = '';
                bottomBackgroundImageInput.value = ''; bottomBackgroundPreview.src = ''; bottomBackgroundPreview.style.display = 'none';
                bottomBackgroundOpacitySlider.value = 1; bottomOpacityValueSpan.textContent = '1.00';
            }
        }, (error) => {
            console.error("Erro ao ler dados do Firebase:", error);
            visibilityStatus.textContent = "Erro de conexão";
            toggleVisibilityBtn.textContent = "Erro";
            toggleVisibilityBtn.disabled = true;
        });

        function updateToggleButton(isVisible) {
            if (isVisible) {
                toggleVisibilityBtn.textContent = 'Desligar Overlay';
                toggleVisibilityBtn.classList.add('active');
            } else {
                toggleVisibilityBtn.textContent = 'Ligar Overlay';
                toggleVisibilityBtn.classList.remove('active');
            }
            toggleVisibilityBtn.disabled = false;
        }

        function updateVisibilityStatus(isVisible) {
            if (isVisible) {
                visibilityStatus.innerHTML = '<span class="on">LIGADA</span>';
            } else {
                visibilityStatus.innerHTML = '<span class="off">DESLIGADA</span>';
            }
        }

        toggleVisibilityBtn.addEventListener('click', () => {
            const currentState = toggleVisibilityBtn.classList.contains('active');
            sponsorStateRef.update({ isVisible: !currentState })
                .then(() => console.log('Visibilidade atualizada!'))
                .catch(error => console.error('Erro ao atualizar visibilidade:', error));
        });

        // Função para converter arquivo de imagem para Base64
        function fileToBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = () => resolve(reader.result);
                reader.onerror = error => reject(error);
            });
        }

        // Função assíncrona para definir (atualizar) os dados de um patrocinador no Firebase
        async function setSponsor(slot) {
            let logoFile, segmentInfo, contactInfo, backgroundImageFile, backgroundOpacity;
            let logoInput, bgImageInput;

            if (slot === 'left') {
                logoInput = leftSponsorLogoInput;
                logoFile = leftSponsorLogoInput.files[0];
                segmentInfo = leftSegmentInfoTextarea.value;
                contactInfo = leftContactInfoTextarea.value;
                bgImageInput = leftBackgroundImageInput;
                backgroundImageFile = leftBackgroundImageInput.files[0];
                backgroundOpacity = parseFloat(leftBackgroundOpacitySlider.value);
            } else { // slot === 'bottom'
                logoInput = bottomSponsorLogoInput;
                logoFile = bottomSponsorLogoInput.files[0];
                segmentInfo = bottomSegmentInfoTextarea.value;
                contactInfo = bottomContactInfoTextarea.value;
                bgImageInput = bottomBackgroundImageInput;
                backgroundImageFile = bottomBackgroundImageInput.files[0];
                backgroundOpacity = parseFloat(bottomBackgroundOpacitySlider.value);
            }

            // Validação do tamanho do arquivo da logo
            if (logoFile && logoFile.size > MAX_FILE_SIZE) {
                alert(`O arquivo da logo selecionado para o slot ${slot === 'left' ? 'Esquerda' : 'Inferior'} (${(logoFile.size / (1024 * 1024)).toFixed(2)} MB) é muito grande. O tamanho máximo permitido é ${MAX_FILE_SIZE / (1024 * 1024)} MB. Por favor, escolha uma imagem menor.`);
                logoInput.value = ''; // Limpa o input file
                return;
            }

            // Validação do tamanho do arquivo da imagem de fundo
            if (backgroundImageFile && backgroundImageFile.size > MAX_FILE_SIZE) {
                alert(`O arquivo de imagem de fundo selecionado para o slot ${slot === 'left' ? 'Esquerda' : 'Inferior'} (${(backgroundImageFile.size / (1024 * 1024)).toFixed(2)} MB) é muito grande. O tamanho máximo permitido é ${MAX_FILE_SIZE / (1024 * 1024)} MB. Por favor, escolha uma imagem menor.`);
                bgImageInput.value = ''; // Limpa o input file
                return;
            }

            let logoBase64 = '';
            if (logoFile) {
                try {
                    logoBase64 = await fileToBase64(logoFile);
                } catch (error) {
                    console.error("Erro ao converter logo para Base64:", error);
                    alert("Erro ao carregar a logo. Tente novamente.");
                    return;
                }
            }

            let backgroundImageBase64 = '';
            if (backgroundImageFile) {
                try {
                    backgroundImageBase64 = await fileToBase64(backgroundImageFile);
                } catch (error) {
                    console.error("Erro ao converter imagem de fundo para Base64:", error);
                    alert("Erro ao carregar a imagem de fundo. Tente novamente.");
                    return;
                }
            }

            const updateData = {};
            updateData[`${slot}Sponsor`] = {
                logo: logoBase64,
                segmentInfo: segmentInfo,
                contactInfo: contactInfo,
                backgroundImage: backgroundImageBase64,
                backgroundOpacity: backgroundOpacity
            };

            sponsorStateRef.update(updateData)
                .then(() => {
                    alert(`Patrocinador da ${slot === 'left' ? 'Barra Lateral Esquerda' : 'Barra Inferior'} atualizado com sucesso!`);
                })
                .catch(error => {
                    console.error(`Erro ao atualizar patrocinador do slot ${slot}:`, error);
                    alert(`Erro ao atualizar patrocinador do slot ${slot} no Firebase. Verifique o console.`);
                });
        }
    </script>
</body>
                </html>
